<html><head><base href="https://example.com">
  <title>Reproductor de Video con HLS</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
      -webkit-user-select: none;
      -moz-user-select: none; 
      -ms-user-select: none;
      user-select: none;
    }
    
    .video-container {
      max-width: 800px;
      margin: 0 auto;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      display: block;
    }
    
    video {
      width: 100%;
      height: auto;
    }
    
    .controls {
      padding: 15px;
      background: #333;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    button {
      background: #4CAF50;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    button:hover {
      background: #45a049;
    }
    
    select {
      padding: 6px;
      border-radius: 4px;
      background: #444;
      color: white;
      border: 1px solid #666;
    }

    .playlist-container {
      display: block;
      margin-top: 20px;
      background: #333;
      padding: 15px;
      border-radius: 8px;
    }

    .playlist-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 10px;
      background: #444;
      border-radius: 4px;
    }

    .playlist-item button {
      padding: 4px 8px;
    }

    .stream-status {
      margin-top: 20px;
      background: #333;
      padding: 15px;
      border-radius: 8px;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 10px;
      background: #444;
      border-radius: 4px;
    }
    
    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    
    .status-good {
      background: #4CAF50;
    }
    
    .status-slow {
      background: #FFA726;
    }
    
    .status-error {
      background: #f44336;
    }
    
    .status-details {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .status-name {
      font-weight: bold;
    }
    
    .status-message {
      font-size: 0.9em;
      color: #aaa;
    }
    
    .viewer-count {
      text-align: center;
      background: #333;
      padding: 10px;
      margin-top: 20px;
      border-radius: 8px;
      color: white;
    }
    
    .tv-focus {
      outline: 3px solid yellow;
      background-color: rgba(255, 255, 0, 0.2);
    }

    .tv-navigation {
      text-align: center;
      background: #333;
      color: white;
      padding: 10px;
      margin-top: 20px;
      border-radius: 8px;
    }
    .playlist-name {
      cursor: pointer;
    }
    
    /* Add login styles */
    .login-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .login-box {
      background: #333;
      padding: 30px;
      border-radius: 8px;
      text-align: center;
    }

    .login-box input {
      padding: 8px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #666;
      background: #444;
      color: white;
    }

    .login-box button {
      margin-top: 10px;
      width: 100%;
    }

    .hidden {
      display: none !important;
    }
    
    .main-content {
      display: none;
    }
    
    .main-content.visible {
      display: block;
    }
  </style>
</head>
<body>
  <div id="loginContainer" class="login-container">
    <div class="login-box">
      <h2>Iniciar Sesi&#xf3;n</h2>
      <input type="password" id="passwordInput" placeholder="Contrase&#xf1;a">
      <button onclick="checkPassword()">Ingresar</button>
    </div>
  </div>
  <div class="main-content">
    <div class="video-section">
      <div class="video-container" id="videoContainer">
        <video id="video" controls></video>
        <div class="controls">
          <button id="playPause">Play/Pause</button>
          <select id="quality">
            <option value>Calidad Auto</option>
          </select>
          <button id="fullscreen">Pantalla Completa</button>
        </div>
      </div>

      <div id="playlistContainer" class="playlist-container">
        <h3>Lista de Reproductores</h3>
        <div id="playlistItems"></div>
      </div>
      <div class="viewer-count">
        Viewer Count: <span id="viewerCount">0</span>
      </div>
    </div>
    <div id="tv-navigation" class="tv-navigation">
      <div class="navigation-instructions">
        &#x25b2; Subir | &#x25bc; Bajar | OK Seleccionar
      </div>
    </div>
  </div>
  <script>let videoUrls = [{
  name: 'Stream Principal',
  url: 'https://stream.gia.tv/giatv/giatv-Gary2CanalGary2Canal/Gary2CanalGary2Canal/chunks.m3u8'
}, {
  name: 'Win+',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'ESPN',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'ESPN 2',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'ESPN 3',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'ESPN 4',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'ESPN EXTRA',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'ESPN Premium',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'Directv',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}, {
  name: 'Solo eventos',
  url: 'https://cale.pricesaskeloadsc.com/espn1/tracks-v1a1/mono.m3u8?token=269839fde5dc06a07156029ce04a546b6e49241a-bf-1736650792-1736614792'
}];
let currentHls = null;
let streamStatuses = {};
let viewerCount = 0;
const TV_KEYS = {
  UP: 38,
  DOWN: 40,
  OK: 13
};
const VIDEO_CONTROLS = {
  PLAY_PAUSE: 0,
  QUALITY: 1,
  FULLSCREEN: 2
};
let currentTVFocus = {
  section: 'playlist',
  index: 0
};
const STREAM_OPTIMIZATION_CONFIG = {
  lowLatencyMode: true,
  dynamicBufferAdjustment: true
};
let isLoggedIn = false;
function generateDeviceId() {
  return Math.random().toString(36).substring(2) + Date.now().toString(36);
}
function playUrl(url) {
  if (currentHls) {
    currentHls.destroy();
  }
  const video = document.getElementById('video');
  const qualitySelect = document.getElementById('quality');
  qualitySelect.innerHTML = '<option value="">Calidad Auto</option>';
  currentHls = new Hls({
    maxBufferLength: 30,
    maxBufferSize: 30 * 1000 * 1000,
    fragLoadingMaxRetry: 2,
    liveSyncDuration: 30,
    liveMaxLatencyDuration: 45,
    enableWorker: true,
    backBufferLength: 10
  });
  currentHls.config.enableMetadata = false;
  currentHls.loadSource(url);
  currentHls.attachMedia(video);
  currentHls.on(Hls.Events.ERROR, function (event, data) {
    const streamIndex = videoUrls.findIndex(item => item.url === url);
    if (streamIndex !== -1) {
      streamStatuses[url] = {
        status: 'error',
        message: `Error: ${data.type} - ${data.details}`
      };
      updateStreamStatus();
    }
  });
  currentHls.on(Hls.Events.FRAG_LOADED, function (event, data) {
    const loadTime = data.stats.loading.end - data.stats.loading.start;
    const streamIndex = videoUrls.findIndex(item => item.url === url);
    if (streamIndex !== -1) {
      if (loadTime > 2000) {
        streamStatuses[url] = {
          status: 'slow',
          message: 'ReproducciÃ³n lenta - Alta latencia'
        };
      } else {
        streamStatuses[url] = {
          status: 'good',
          message: 'ReproducciÃ³n estable'
        };
      }
      updateStreamStatus();
    }
  });
  currentHls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
    const qualities = data.levels.map((level, index) => ({
      index: index,
      resolution: `${level.width}x${level.height}`,
      bitrate: level.bitrate
    }));
    qualities.forEach(quality => {
      const option = document.createElement('option');
      option.value = quality.index;
      option.text = `${quality.resolution} (${Math.round(quality.bitrate / 1000)} kbps)`;
      qualitySelect.appendChild(option);
    });
    currentHls.currentLevel = Math.min(1, currentHls.levels.length - 1);
    video.play();
  });
}
function updatePlaylist() {
  const container = document.getElementById('playlistItems');
  container.innerHTML = '';
  videoUrls.forEach((item, index) => {
    const playlistItem = document.createElement('div');
    playlistItem.className = 'playlist-item';
    const playButton = document.createElement('button');
    playButton.textContent = 'Reproducir';
    playButton.onclick = () => {
      playUrl(item.url);
      setTimeout(() => {
        document.getElementById('video').play();
      }, 500);
    };
    const nameSpan = document.createElement('span');
    nameSpan.className = 'playlist-name';
    nameSpan.textContent = item.name;
    nameSpan.onclick = () => {
      playUrl(item.url);
      setTimeout(() => {
        document.getElementById('video').play();
      }, 500);
    };
    playlistItem.appendChild(playButton);
    playlistItem.appendChild(nameSpan);
    container.appendChild(playlistItem);
  });
  updateStreamStatus();
}
function initializeVideo() {
  const video = document.getElementById('video');
  const playPauseBtn = document.getElementById('playPause');
  const qualitySelect = document.getElementById('quality');
  const fullscreenBtn = document.getElementById('fullscreen');
  playUrl(videoUrls[0].url);
  playPauseBtn.addEventListener('click', function () {
    if (video.paused) {
      video.play();
    } else {
      video.pause();
    }
  });
  fullscreenBtn.addEventListener('click', function () {
    if (!document.fullscreenElement) {
      if (video.requestFullscreen) {
        video.requestFullscreen();
      } else if (video.webkitRequestFullscreen) {
        video.webkitRequestFullscreen();
      } else if (video.msRequestFullscreen) {
        video.msRequestFullscreen();
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
    }
  });
  video.addEventListener('play', () => {
    playPauseBtn.textContent = 'Pause';
  });
  video.addEventListener('pause', () => {
    playPauseBtn.textContent = 'Play';
  });
  qualitySelect.addEventListener('change', function () {
    if (currentHls) {
      if (this.value === '') {
        currentHls.currentLevel = -1;
      } else {
        const selectedLevel = Number(this.value);
        currentHls.currentLevel = selectedLevel;
        console.log(`Selected quality: ${currentHls.levels[selectedLevel].height}p`);
      }
    }
  });
  document.addEventListener('keydown', event => {
    switch (event.key) {
      case 'ArrowUp':
        break;
      case 'ArrowDown':
        break;
      case 'ArrowLeft':
        break;
      case 'ArrowRight':
        break;
      case 'Enter':
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
        break;
      case 'Escape':
        if (document.fullscreenElement) {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          }
        }
        break;
      default:
        break;
    }
  });
}
function updateStreamStatus() {
  const container = document.getElementById('playlistContainer');
  let statusContainer = document.querySelector('.stream-status');
  if (!statusContainer) {
    statusContainer = document.createElement('div');
    statusContainer.className = 'stream-status';
    statusContainer.innerHTML = '<h3>Estado de Streams</h3>';
    container.appendChild(statusContainer);
  }
  const statusContent = document.createElement('div');
  videoUrls.forEach(item => {
    const status = streamStatuses[item.url] || {
      status: 'unknown',
      message: 'No reproducido aÃºn'
    };
    const statusItem = document.createElement('div');
    statusItem.className = 'status-item';
    const indicator = document.createElement('div');
    indicator.className = `status-indicator status-${status.status}`;
    const details = document.createElement('div');
    details.className = 'status-details';
    const name = document.createElement('div');
    name.className = 'status-name';
    name.textContent = item.name;
    const message = document.createElement('div');
    message.className = 'status-message';
    message.textContent = status.message;
    details.appendChild(name);
    details.appendChild(message);
    statusItem.appendChild(indicator);
    statusItem.appendChild(details);
    statusContent.appendChild(statusItem);
  });
  statusContainer.innerHTML = '<h3>Estado de Streams</h3>';
  statusContainer.appendChild(statusContent);
}
function initializeVideoPage() {
  document.body.onmousedown = function (e) {
    if (e.button === 0) {
      e.preventDefault();
      return false;
    }
  };
  
  document.getElementById('videoContainer').style.display = 'block';
  initializeVideo();
  updatePlaylist();
  viewerCount++;
  updateViewerCount();
  document.addEventListener('keydown', handleTVNavigation);
  document.querySelector('.main-content').style.display = 'block';
}
function checkReferrer() {
  return isLoggedIn;
}
function getCurrentUser() {
  return 'default';
}
function updateViewerCount() {
  let viewerCountContainer = document.getElementById('viewerCountContainer');
  if (!viewerCountContainer) {
    viewerCountContainer = document.createElement('div');
    viewerCountContainer.id = 'viewerCountContainer';
    viewerCountContainer.className = 'viewer-count';
    document.querySelector('.main-content').appendChild(viewerCountContainer);
  }
  viewerCountContainer.textContent = `Personas viendo: ${viewerCount}`;
}
function handleTVNavigation(event) {
  document.body.onmousedown = function (e) {
    if (e.button === 0) {
      e.preventDefault(); 
      return false;
    }
  };

  // Get references to DOM elements
  const playlistItems = document.querySelectorAll('.playlist-item');
  const videoPlayer = document.getElementById('video');
  const controls = document.querySelectorAll('.controls button, .controls select');

  // Only handle navigation if elements exist
  if (!playlistItems.length || !videoPlayer || !controls.length) {
    return;
  }

  const navigationSections = ['playlist', 'videoPlayer', 'controls'];

  switch (event.keyCode) {
    case TV_KEYS.UP:
      navigateUp(playlistItems, videoPlayer, controls);
      break;
    case TV_KEYS.DOWN:
      navigateDown(playlistItems, videoPlayer, controls);
      break;
    case TV_KEYS.OK:
      selectCurrentItem(playlistItems, videoPlayer, controls);
      break;
  }
}
function navigateUp(playlistItems, videoPlayer, controls) {
  if (currentTVFocus.section === 'playlist' && currentTVFocus.index > 0) {
    currentTVFocus.index--;
    highlightCurrentItem(playlistItems, videoPlayer, controls);
  } else if (currentTVFocus.section === 'videoPlayer') {
    currentTVFocus.section = 'playlist';
    currentTVFocus.index = playlistItems.length - 1;
    highlightCurrentItem(playlistItems, videoPlayer, controls);
  } else if (currentTVFocus.section === 'controls') {
    currentTVFocus.section = 'videoPlayer';
    currentTVFocus.index = 0;
    highlightCurrentItem(playlistItems, videoPlayer, controls);
  }
}
function navigateDown(playlistItems, videoPlayer, controls) {
  if (currentTVFocus.section === 'playlist' && currentTVFocus.index < playlistItems.length - 1) {
    currentTVFocus.index++;
    highlightCurrentItem(playlistItems, videoPlayer, controls);
  } else if (currentTVFocus.section === 'playlist' && currentTVFocus.index === playlistItems.length - 1) {
    currentTVFocus.section = 'videoPlayer';
    currentTVFocus.index = 0;
    highlightCurrentItem(playlistItems, videoPlayer, controls);
  } else if (currentTVFocus.section === 'videoPlayer') {
    currentTVFocus.section = 'controls';
    currentTVFocus.index = 0;
    highlightCurrentItem(playlistItems, videoPlayer, controls);
  }
}
function selectCurrentItem(playlistItems, videoPlayer, controls) {
  // Guard against undefined elements
  if (!playlistItems?.length || !videoPlayer || !controls?.length) {
    return;
  }

  if (currentTVFocus.section === 'playlist' && playlistItems[currentTVFocus.index]) {
    const playButton = playlistItems[currentTVFocus.index].querySelector('button');
    if (playButton) {
      playButton.click();
    }
  } else if (currentTVFocus.section === 'videoPlayer') {
    if (videoPlayer.paused) {
      videoPlayer.play();
    } else {
      videoPlayer.pause();
    }
  } else if (currentTVFocus.section === 'controls' && controls[currentTVFocus.index]) {
    controls[currentTVFocus.index].click();
  }
}
function highlightCurrentItem(playlistItems, videoPlayer, controls) {
  // Guard against undefined elements
  if (!playlistItems?.length || !videoPlayer || !controls?.length) {
    return;
  }

  // Remove focus from all elements
  playlistItems.forEach(item => item.classList.remove('tv-focus'));
  videoPlayer.classList.remove('tv-focus');
  controls.forEach(control => control.classList.remove('tv-focus'));

  // Add focus to current element
  if (currentTVFocus.section === 'playlist' && playlistItems[currentTVFocus.index]) {
    playlistItems[currentTVFocus.index].classList.add('tv-focus');
  } else if (currentTVFocus.section === 'videoPlayer') {
    videoPlayer.classList.add('tv-focus');
  } else if (currentTVFocus.section === 'controls' && controls[currentTVFocus.index]) {
    controls[currentTVFocus.index].classList.add('tv-focus');
  }
}
function checkPassword() {
  const password = document.getElementById('passwordInput').value;
  if (password === '1344') {
    isLoggedIn = true;
    
    // Hide login container
    document.getElementById('loginContainer').classList.add('hidden');
    
    // Show main content explicitly
    const mainContent = document.querySelector('.main-content');
    mainContent.classList.add('visible');
    
    // Ensure video container is displayed
    const videoContainer = document.getElementById('videoContainer');
    videoContainer.style.display = 'block';
    
    // Ensure playlist container is displayed
    const playlistContainer = document.getElementById('playlistContainer');
    playlistContainer.style.display = 'block';
    
    // Initialize video page
    initializeVideoPage();
  } else {
    alert('Contraseña incorrecta');
    document.getElementById('passwordInput').value = '';
  }
}
document.getElementById('passwordInput').addEventListener('keypress', function (e) {
  if (e.key === 'Enter') {
    checkPassword();
  }
});
document.addEventListener('keydown', handleTVNavigation);
document.addEventListener('contextmenu', function (e) {
  e.preventDefault();
  return false;
});
</script>
</body>
</html>
